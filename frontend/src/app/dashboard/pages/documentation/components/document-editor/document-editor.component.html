<div class="editor-container" *ngIf="document && template">
  <div class="editor-header">
    <div class="document-info">
      <input
        type="text"
        class="document-title-input"
        [(ngModel)]="document.name"
        placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞">
      <div class="document-meta">
        <span class="document-template">{{ template.name }}</span>
        <span class="document-status" [class]="document.status">
              {{ getStatusLabel(document.status) }}
            </span>
      </div>
    </div>
    <div class="editor-actions">
      <button class="cyber-button" (click)="onSave()">
        <i>üíæ</i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
      </button>
      <button class="cyber-button" (click)="onPublish()" *ngIf="document.status !== 'published'">
        <i>üì§</i> –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
      </button>
      <button class="cyber-button" (click)="onExport()">
        <i>üì•</i> –≠–∫—Å–ø–æ—Ä—Ç
      </button>
      <button class="cyber-button" (click)="onCancel()">
        <i>‚úñÔ∏è</i> –û—Ç–º–µ–Ω–∞
      </button>
    </div>
  </div>

  <div class="editor-content">
    <div class="document-sections">
      <div *ngFor="let section of template.sections" class="document-section">
        <div class="section-header">
          <h3>{{ section.title }}</h3>
          <span class="required-badge" *ngIf="section.required">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
        </div>

        <ng-container [ngSwitch]="section.type">
          <!-- –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª -->
          <div *ngSwitchCase="'text'" class="section-content">
                <textarea
                  class="cyber-input section-textarea"
                  [(ngModel)]="document.sections[section.id]"
                  [placeholder]="section.placeholder || '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç...'"
                  rows="6"></textarea>
          </div>

          <!-- –¢–∞–±–ª–∏—Ü–∞ -->
          <div *ngSwitchCase="'table'" class="section-content">
            <div class="table-controls">
              <button class="cyber-button small" (click)="addTableRow(section.id)">
                <i>+</i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
              </button>
              <button class="cyber-button small" (click)="addTableColumn(section.id)">
                <i>+</i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü
              </button>
            </div>
            <div class="table-wrapper">
              <table class="cyber-table editable-table">
                <thead>
                <tr>
                  <th *ngFor="let col of getTableColumns(section.id); let colIndex = index">
                    <input
                      type="text"
                      class="table-header-input"
                      [(ngModel)]="document.sections[section.id].headers[colIndex]"
                      placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
                    <button
                      class="remove-column-btn"
                      (click)="removeTableColumn(section.id, colIndex)"
                      *ngIf="document.sections[section.id].headers.length > 1">
                      ‚úï
                    </button>
                  </th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let row of getTableRows(section.id); let rowIndex = index">
                  <td *ngFor="let col of getTableColumns(section.id); let colIndex = index">
                    <input
                      type="text"
                      class="table-cell-input"
                      [(ngModel)]="document.sections[section.id].rows[rowIndex][colIndex]"
                      placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ">
                  </td>
                  <td class="row-actions">
                    <button
                      class="remove-row-btn"
                      (click)="removeTableRow(section.id, rowIndex)"
                      *ngIf="document.sections[section.id].rows.length > 1">
                      ‚úï
                    </button>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- –°–ø–∏—Å–æ–∫ -->
          <div *ngSwitchCase="'list'" class="section-content">
            <div class="list-controls">
              <button class="cyber-button small" (click)="addListItem(section.id)">
                <i>+</i> –î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç
              </button>
            </div>
            <div class="list-items">
              <div
                *ngFor="let item of getListItems(section.id); let itemIndex = index"
                class="list-item">
                <input
                  type="text"
                  class="cyber-input list-item-input"
                  [(ngModel)]="document.sections[section.id][itemIndex]"
                  placeholder="–≠–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞">
                <button
                  class="remove-item-btn"
                  (click)="removeListItem(section.id, itemIndex)"
                  *ngIf="document.sections[section.id].length > 1">
                  ‚úï
                </button>
              </div>
            </div>
          </div>

          <!-- –ö–æ–¥ -->
          <div *ngSwitchCase="'code'" class="section-content">
            <div class="code-controls">
              <select class="cyber-input language-select" [(ngModel)]="document.sections[section.id].language">
                <option value="bash">Bash</option>
                <option value="javascript">JavaScript</option>
                <option value="python">Python</option>
                <option value="sql">SQL</option>
                <option value="json">JSON</option>
                <option value="xml">XML</option>
                <option value="yaml">YAML</option>
              </select>
            </div>
            <textarea
              class="cyber-input code-textarea"
              [(ngModel)]="document.sections[section.id].code"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥..."
              rows="10"></textarea>
          </div>

          <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
          <div *ngSwitchCase="'image'" class="section-content">
            <div class="image-controls">
              <input
                type="text"
                class="cyber-input image-url-input"
                [(ngModel)]="document.sections[section.id].url"
                placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
            </div>
            <div class="image-preview" *ngIf="document.sections[section.id]?.url">
              <img [src]="document.sections[section.id].url" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
            </div>
            <div class="image-caption">
              <input
                type="text"
                class="cyber-input caption-input"
                [(ngModel)]="document.sections[section.id].caption"
                placeholder="–ü–æ–¥–ø–∏—Å—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é">
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>
