<div class="reports-container">
  <div class="reports-header">
    <h2>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç—á–µ—Ç–æ–≤</h2>
    <button class="cyber-button" (click)="onCreateReport()">
      <i>+</i> –ù–æ–≤—ã–π –æ—Ç—á–µ—Ç
    </button>
  </div>

  <div class="reports-tabs">
    <button
      class="tab-button"
      [class.active]="activeTab === 'templates'"
      (click)="activeTab = 'templates'">
      –®–∞–±–ª–æ–Ω—ã –æ—Ç—á–µ—Ç–æ–≤
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'scheduled'"
      (click)="activeTab = 'scheduled'">
      –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'history'"
      (click)="activeTab = 'history'">
      –ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á–µ—Ç–æ–≤
    </button>
  </div>

  <!-- –®–∞–±–ª–æ–Ω—ã –æ—Ç—á–µ—Ç–æ–≤ -->
  <div *ngIf="activeTab === 'templates'" class="report-templates">
    <div class="templates-grid">
      <div
        *ngFor="let template of reportTemplates"
        class="report-template cyber-card"
        (click)="onSelectReportTemplate(template)">
        <div class="template-icon" [class]="template.type">
          <i>{{ getReportTypeIcon(template.type) }}</i>
        </div>
        <div class="template-info">
          <h3>{{ template.name }}</h3>
          <div class="template-meta">
                <span class="template-type" [class]="template.type">
                  {{ getReportTypeLabel(template.type) }}
                </span>
            <span class="template-period">
                  {{ getPeriodLabel(template.period) }}
                </span>
          </div>
        </div>
        <div class="template-actions">
          <button class="cyber-button small" (click)="$event.stopPropagation(); onGenerateReport(template)">
            <i>‚ö°</i> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
          </button>
          <button class="cyber-button small" (click)="$event.stopPropagation(); onScheduleReport(template)">
            <i>üïí</i> –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã -->
  <div *ngIf="activeTab === 'scheduled'" class="scheduled-reports">
    <div class="reports-list">
      <div *ngIf="scheduledReports.length === 0" class="empty-state">
        <div class="empty-icon">üïí</div>
        <h3>–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤</h3>
        <p>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –æ—Ç—á–µ—Ç –∏–ª–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —à–∞–±–ª–æ–Ω</p>
      </div>

      <div
        *ngFor="let report of scheduledReports"
        class="report-item cyber-card">
        <div class="report-info">
          <h3>{{ report.name }}</h3>
          <div class="report-meta">
                <span class="report-type" [class]="report.type">
                  {{ getReportTypeLabel(report.type) }}
                </span>
            <span class="report-schedule">
                  {{ getScheduleLabel(report.schedule) }}
                </span>
          </div>
          <div class="report-details">
            <div class="detail-item">
              <span class="detail-label">–ü–æ—Å–ª–µ–¥–Ω—è—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è:</span>
              <span class="detail-value">{{ formatDate(report.lastGenerated) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">–ü–æ–ª—É—á–∞—Ç–µ–ª–∏:</span>
              <span class="detail-value">{{ getRecipientsList(report) }}</span>
            </div>
          </div>
        </div>
        <div class="report-actions">
          <button class="cyber-button small" (click)="onEditReport(report)">
            <i>‚úèÔ∏è</i> –ò–∑–º–µ–Ω–∏—Ç—å
          </button>
          <button class="cyber-button small" (click)="onGenerateReport(report)">
            <i>‚ö°</i> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
          </button>
          <button class="cyber-button small warning" (click)="onDeleteReport(report)">
            <i>üóëÔ∏è</i> –£–¥–∞–ª–∏—Ç—å
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- –ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á–µ—Ç–æ–≤ -->
  <div *ngIf="activeTab === 'history'" class="report-history">
    <div class="reports-list">
      <div *ngIf="reportHistory.length === 0" class="empty-state">
        <div class="empty-icon">üìä</div>
        <h3>–ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á–µ—Ç–æ–≤ –ø—É—Å—Ç–∞</h3>
        <p>–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –æ—Ç—á–µ—Ç, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –µ–≥–æ –≤ –∏—Å—Ç–æ—Ä–∏–∏</p>
      </div>

      <div
        *ngFor="let report of reportHistory"
        class="report-item cyber-card">
        <div class="report-info">
          <h3>{{ report.name }}</h3>
          <div class="report-meta">
                <span class="report-type" [class]="report.type">
                  {{ getReportTypeLabel(report.type) }}
                </span>
            <span class="report-format">
                  {{ report.format.toUpperCase() }}
                </span>
          </div>
          <div class="report-details">
            <div class="detail-item">
              <span class="detail-label">–î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:</span>
              <span class="detail-value">{{ formatDate(report.lastGenerated) }}</span>
            </div>
          </div>
        </div>
        <div class="report-actions">
          <button class="cyber-button small" (click)="onViewReport(report)">
            <i>üëÅÔ∏è</i> –ü—Ä–æ—Å–º–æ—Ç—Ä
          </button>
          <button class="cyber-button small" (click)="onDownloadReport(report)">
            <i>üì•</i> –°–∫–∞—á–∞—Ç—å
          </button>
          <button class="cyber-button small" (click)="onRegenerateReport(report)">
            <i>üîÑ</i> –û–±–Ω–æ–≤–∏—Ç—å
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞ -->
  <div *ngIf="showReportForm" class="report-form-overlay">
    <div class="report-form cyber-card">
      <div class="form-header">
        <h3>{{ editingReport ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞' : '–ù–æ–≤—ã–π –æ—Ç—á–µ—Ç' }}</h3>
        <button class="close-button" (click)="closeReportForm()">‚úï</button>
      </div>
      <div class="form-content">
        <div class="form-group">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞</label>
          <input type="text" class="cyber-input" [(ngModel)]="currentReport.name">
        </div>
        <div class="form-group">
          <label>–¢–∏–ø –æ—Ç—á–µ—Ç–∞</label>
          <select class="cyber-input" [(ngModel)]="currentReport.type">
            <option value="server">–°–µ—Ä–≤–µ—Ä—ã</option>
            <option value="network">–°–µ—Ç—å</option>
            <option value="security">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</option>
            <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
            <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π</option>
          </select>
        </div>
        <div class="form-group">
          <label>–ü–µ—Ä–∏–æ–¥</label>
          <select class="cyber-input" [(ngModel)]="currentReport.period">
            <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
            <option value="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
            <option value="monthly">–ï–∂–µ–º–µ—Å—è—á–Ω–æ</option>
            <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π</option>
          </select>
        </div>
        <div class="form-group">
          <label>–§–æ—Ä–º–∞—Ç</label>
          <select class="cyber-input" [(ngModel)]="currentReport.format">
            <option value="pdf">PDF</option>
            <option value="html">HTML</option>
            <option value="csv">CSV</option>
            <option value="json">JSON</option>
          </select>
        </div>

        <div class="form-section">
          <h4>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h4>
          <div class="form-group">
            <label class="cyber-switch">
              <input type="checkbox" [(ngModel)]="scheduleEnabled">
              <span class="switch-slider"></span>
              <span class="switch-label">–í–∫–ª—é—á–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span>
            </label>
          </div>

          <div *ngIf="scheduleEnabled" class="schedule-options">
            <div class="form-group">
              <label>–ß–∞—Å—Ç–æ—Ç–∞</label>
              <select class="cyber-input" [(ngModel)]="scheduleFrequency">
                <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                <option value="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
                <option value="monthly">–ï–∂–µ–º–µ—Å—è—á–Ω–æ</option>
              </select>
            </div>

            <div class="form-group" *ngIf="scheduleFrequency === 'weekly'">
              <label>–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏</label>
              <select class="cyber-input" [(ngModel)]="scheduleDay">
                <option value="1">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
                <option value="2">–í—Ç–æ—Ä–Ω–∏–∫</option>
                <option value="3">–°—Ä–µ–¥–∞</option>
                <option value="4">–ß–µ—Ç–≤–µ—Ä–≥</option>
                <option value="5">–ü—è—Ç–Ω–∏—Ü–∞</option>
                <option value="6">–°—É–±–±–æ—Ç–∞</option>
                <option value="0">–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</option>
              </select>
            </div>

            <div class="form-group" *ngIf="scheduleFrequency === 'monthly'">
              <label>–î–µ–Ω—å –º–µ—Å—è—Ü–∞</label>
              <select class="cyber-input" [(ngModel)]="scheduleDay">
                <option *ngFor="let day of monthDays" [value]="day">{{ day }}</option>
              </select>
            </div>

            <div class="form-group">
              <label>–í—Ä–µ–º—è</label>
              <input type="time" class="cyber-input" [(ngModel)]="scheduleTime">
            </div>

            <div class="form-group">
              <label>–ü–æ–ª—É—á–∞—Ç–µ–ª–∏ (email)</label>
              <div class="recipients-input">
                <div class="recipients-list">
                      <span
                        *ngFor="let recipient of scheduleRecipients; let i = index"
                        class="recipient-tag">
                        {{ recipient }}
                        <button class="remove-recipient" (click)="removeRecipient(i)">‚úï</button>
                      </span>
                </div>
                <div class="add-recipient">
                  <input
                    type="email"
                    class="cyber-input"
                    [(ngModel)]="newRecipient"
                    placeholder="–î–æ–±–∞–≤–∏—Ç—å email..."
                    (keydown.enter)="addRecipient()">
                  <button class="cyber-button small" (click)="addRecipient()">
                    <i>+</i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞</h4>
          <div class="form-group">
            <label>–†–∞–∑–¥–µ–ª—ã</label>
            <div class="sections-checkboxes">
              <label class="cyber-checkbox" *ngFor="let section of availableSections">
                <input
                  type="checkbox"
                  [checked]="isSelectedSection(section.id)"
                  (change)="toggleSection(section.id)">
                <span class="checkbox-label">{{ section.name }}</span>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>–§–∏–ª—å—Ç—Ä—ã</label>
            <div class="filters-form" [ngSwitch]="currentReport.type">
              <!-- –°–µ—Ä–≤–µ—Ä—ã -->
              <div *ngSwitchCase="'server'">
                <div class="filter-item">
                  <label>–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–æ–≤</label>
                  <select class="cyber-input" [(ngModel)]="currentReport.config.filters.status">
                    <option value="all">–í—Å–µ</option>
                    <option value="online">–û–Ω–ª–∞–π–Ω</option>
                    <option value="offline">–û—Ñ–ª–∞–π–Ω</option>
                    <option value="warning">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</option>
                  </select>
                </div>
                <div class="filter-item">
                  <label>–ü–æ—Ä–æ–≥ –∑–∞–≥—Ä—É–∑–∫–∏ CPU (%)</label>
                  <input
                    type="number"
                    class="cyber-input"
                    [(ngModel)]="currentReport.config.filters.cpuThreshold"
                    min="0"
                    max="100">
                </div>
              </div>

              <!-- –°–µ—Ç—å -->
              <div *ngSwitchCase="'network'">
                <div class="filter-item">
                  <label>–ü–µ—Ä–∏–æ–¥</label>
                  <select class="cyber-input" [(ngModel)]="currentReport.config.filters.period">
                    <option value="1d">1 –¥–µ–Ω—å</option>
                    <option value="7d">7 –¥–Ω–µ–π</option>
                    <option value="30d">30 –¥–Ω–µ–π</option>
                  </select>
                </div>
                <div class="filter-item">
                  <label>–í–∫–ª—é—á–∏—Ç—å –∞–Ω–æ–º–∞–ª–∏–∏</label>
                  <label class="cyber-switch">
                    <input
                      type="checkbox"
                      [(ngModel)]="currentReport.config.filters.includeAnomalies">
                    <span class="switch-slider"></span>
                  </label>
                </div>
              </div>

              <!-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
              <div *ngSwitchCase="'security'">
                <div class="filter-item">
                  <label>–£—Ä–æ–≤–µ–Ω—å –≤–∞–∂–Ω–æ—Å—Ç–∏</label>
                  <select class="cyber-input" [(ngModel)]="currentReport.config.filters.severity">
                    <option value="all">–í—Å–µ</option>
                    <option value="critical">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π</option>
                    <option value="high">–í—ã—Å–æ–∫–∏–π</option>
                    <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
                    <option value="low">–ù–∏–∑–∫–∏–π</option>
                  </select>
                </div>
              </div>

              <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
              <div *ngSwitchCase="'user'">
                <div class="filter-item">
                  <label>–°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</label>
                  <select class="cyber-input" [(ngModel)]="currentReport.config.filters.userStatus">
                    <option value="all">–í—Å–µ</option>
                    <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                    <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="form-actions">
        <button class="cyber-button" (click)="closeReportForm()">–û—Ç–º–µ–Ω–∞</button>
        <button class="cyber-button primary" (click)="saveReport()">
          {{ editingReport ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å' }}
        </button>
      </div>
    </div>
  </div>
</div>
